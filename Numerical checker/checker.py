###Numerical checker of third order condtions of huestrics
###This to ensure that genearted schemes with the huestrics hold numerically under strict third order condtions
import numpy as np

huestrics = {"1":("a[1,0] = b[9]**2",[
    0.010353192801789424, 0.008280757658519874, 0.018426173311949567,
    0.008280757658516777, 0.002174367105545582, 0.08945178978973779,
    0.008280757658517544, 0.002174367105545582, 0.07643173141094187,
    0.06226488983359442, 0.008280757658517612, 0.002174367105545582,
    0.076431731410942, 0.06334091240572876, 0.8562323712883272,
    0.008280757658517617, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572877, 0.002591265543602608, 0.017975957081130277,
    0.008280757658517615, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.0025912655436026227, 0.14161013638303202,
    0.05142119302314059, 0.008280757658517615, 0.002174367105545582,
    0.07643173141094202, 0.06334091240572878, 0.0025912655436026244,
    0.14161013638303271, 0.10349471367071784, 0.26792383586784135,
    0.008280757658517617, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.0025912655436026205, 0.14161013638303244,
    0.10349471367071848, 0.01984989687226824, 0.0011165786582949845,
    0.008280757658517617, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.002591265543602629, 0.14161013638303252,
    0.10349471367071783, 0.01984989687226726, 0.0014129782238071545,
    0.03822375214425407, 0.008280757658517615, 0.002174367105545582,
    0.07643173141094202, 0.06334091240572878, 0.0025912655436026158,
    0.1416101363830327, 0.10349471367071791, 0.019849896872267132,
    0.0014129782238071545, 0.10175064030162033, 0.32630116794911007,
    0.008280757658517615, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.0025912655436026158, 0.14161013638303274,
    0.10349471367071782, 0.01984989687226683, 0.0014129782238071545,
    0.10175064030162027, 0.009700146915903611, 0.005291858529276196,
    0.008280757658517615, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.0025912655436026158, 0.14161013638303266,
    0.10349471367071794, 0.019849896872267247, 0.0014129782238071545,
    0.10175064030162032, 0.00970014691590373, 0.010359509728598209,
    0.03778777617984478, 0.008280757658517615, 0.002174367105545582,
    0.07643173141094202, 0.06334091240572878, 0.0025912655436026158,
    0.14161013638303263, 0.10349471367071797, 0.01984989687226747,
    0.0014129782238071545, 0.10175064030162041, 0.0097001469159039,
    0.010359509728599557, 0.011683848518759808, 0.042170687897232204
]
,[
    0.008280757658517615, 0.002174367105545582, 0.07643173141094202,
    0.06334091240572878, 0.0025912655436026158, 0.1416101363830327,
    0.10349471367071791, 0.019849896872267153, 0.0014129782238071545,
    0.10175064030162038, 0.009700146915903948, 0.010359509728599225,
    0.011683848518759752, 0.3094709876769489, 0.13784810758400443
]),"2":("a[11,0] = a[4,1] + a[4,2]",[0.3675593019535731, 0.06295169728755634, 0.0030263894903966573, 0.06295169728755634, 0.0029229292069855037, 0.013799531956546684, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.025090932021224817, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.5289970886122701, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.018080675116797586, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.5458601133003473, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.012273573975024437, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.3815881107963953, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.0018686223555469481, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.007744426301339289, 0.019025658442241904, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.007744426301339289, 0.016379622476186698, 0.018006007605002296, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.007744426301339289, 0.016379622476186698, 0.0005149957187224255, 0.06886275398843993, 0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.007744426301339289, 0.016379622476186698, 0.0005149957187224255, 0.2736515509582215, 0.270755644001278],[0.06295169728755634, 0.0029229292069855037, 0.019346079841493422, 0.14783294860314986, 0.003929235515487658, 0.08799106498740665, 0.027089988117726845, 0.12663584747298925, 0.00276499651380806, 0.007744426301339289, 0.016379622476186698, 0.0005149957187224255, 0.2736515509582215, 0.1877955604123146, 0.032449056586611846])

,"3":("a[13,1]=b[2]**4",[0.1593861867782114, 0.036959906830514797, 0.0026813241922549334, 0.036959906830514797, 0.0, 0.043823421598573865, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.2194237773530457, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 0.002258945036323757, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 0.035894002368403816, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.2122809368449764, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 0.004464427955873496, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 0.04518492528372683, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.011479860852217152, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.06763636813044478, 0.13044602196730895, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.06763636813044478, 2.2065920255690185e-09, 0.0071051041012946264, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.06763636813044478, 2.2065920255690185e-09, 0.3002162610912352, 0.32301622561626964, 0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.06763636813044478, 2.2065920255690185e-09, 0.3002162610912352, 0.0017435071544150194, 0.20899278500042803]
,[0.036959906830514797, 0.0, 4.71766682245512e-08, 0.0765302564935237, 4.128724336014651e-10, 1.1263610624780487e-08, 0.11269104735748092, 1.841245680833331e-09, 3.618784282906306e-09, 0.06763636813044478, 2.2065920255690185e-09, 0.3002162610912352, 0.0017435071544150194, 0.04833753421087329, 0.35588505221173905]),"4":("a[9,1] =c[1]**3",[0.22462328101724516, 0.11080742832875232, 0.006604888571202824, 0.11080742832875251, 0.011333506545135475, 0.21278891965051042, 0.11080742832875265, 0.011333506545135489, 0.09945406451281301, 0.008755424916919517, 0.1108074283287526, 0.011333506545135479, 0.09945406451281295, 0.029715710321581826, 0.20135563686499447, 0.11080742832875264, 0.011333506545135517, 0.09945406451281301, 0.029715710321581892, 7.64613114101706e-11, 0.009714645196807748, 0.1108074283287526, 0.011333506545135472, 0.09945406451281295, 0.02971571032158181, 7.64612646937553e-11, 0.009695413935172743, 0.20010275763740334, 0.11080742832875246, 0.011333506545135298, 0.09945406451281281, 0.029715710321581712, 7.646115240098343e-11, 0.0096954139351728, 1.7997583374028426e-11, 0.001883791128392463, 0.11080742832875302, 0.01133350654513554, 0.09945406451281323, 0.029715710321581802, 7.646138891615262e-11, 0.009695413935172651, 1.7997709643783454e-11, 0.008002295907741007, 0.14265333671937558, 0.11080742832875361, 0.011333506545135383, 0.09945406451281341, 0.029715710321581327, 7.646135930411286e-11, 0.00969541393517245, 1.7997694521201708e-11, 0.008002295907740908, 2.0337158312115632e-11, 0.006211057204020224, 0.11080742832875218, 0.011333506545135813, 0.09945406451281291, 0.029715710321582066, 7.646133836874622e-11, 0.009695413935172804, 1.7997642574383197e-11, 0.008002295907741038, 2.0337111500459907e-11, 0.24764162543390755, 0.28698791785033057, 0.11080742832875264, 0.01133350654513517, 0.09945406451281284, 0.029715710321581663, 7.64611405332776e-11, 0.00969541393517265, 1.799749658842171e-11, 0.00800229590774087, 2.033696418659177e-11, 0.2476416254339074, 3.3196215629703193e-12, 0.2912225456314287, 0.11080742832875265, 0.011333506545135364, 0.09945406451281294, 0.02971571032158177, 7.646123380236505e-11, 0.009695413935172714, 1.799757759504048e-11, 0.008002295907740936, 2.0337046834201872e-11, 0.24764162543390747, 3.3196995520826387e-12, 0.06925944500191128, 0.008857457609231784, 0.11080742832875264, 0.011333506545135477, 0.09945406451281298, 0.029715710321581816, 7.64612708939877e-11, 0.009695413935172717, 1.7997605917010297e-11, 0.008002295907740946, 2.0337074842743533e-11, 0.24764162543390747, 3.3197251104657682e-12, 0.06925944500191125, 0.2717980255881756, 0.2239142631137071]
,[0.11080742832875265, 0.011333506545135468, 0.09945406451281301, 0.029715710321581778, 7.646127837403154e-11, 0.009695413935172693, 1.7997620541839486e-11, 0.008002295907740953, 2.033707981126413e-11, 0.24764162543390747, 3.31970514232636e-12, 0.06925944500191124, 0.2717980255881757, 0.1301070139373952, 0.012185470369298379]
),"5":("a[8,3] == c[8] + b[9] + a[8,5]",[0.1998170226914221, 0.0852469774331897, 0.1998169394253252, 0.08894036191371094, 0.0792564803082432, 0.19981685006528274, 1.5307511640721065e-07, 1.1119628645182117e-07, 4.4700135264617225e-08, 0.1998163684418118, 0.08496481768162445, 4.432215028123092e-07, 1.327405764810486e-07, 2.814927717102926e-08, 0.19981631695437088, 0.07487690019966323, 0.08597499394192075, 0.0715137176627769, 1.764468468662607e-07, 2.8796462408347996e-08, 0.19981636705496433, 0.05231888153461113, 0.0750184952945254, 0.08641123663277075, 0.08334338025678006, 2.0177983630156328e-07, 2.9460412256587925e-08, 0.19981641948242093, 0.0, 0.0, 0.0, 2.893548929505185e-09, 0.0, 0.0, 0.0, 2.2552175946456022e-11, 7.29210350882677e-09, 4.22119046557795e-09, 2.5830204021510664e-09, 2.1593979367659663e-09, 8.527950504971016e-09, 3.018695263547992e-06, 1.0662624441157805e-07, 2.351982064608675e-09, 0.19981380772519414, 0.08368337421282436, 7.0447760752865376e-09, 3.616965343178309e-09, 2.35048034808371e-09, 4.051838814187315e-09, 5.4078447172669464e-05, 4.001784331517422e-09, 3.5040377480995603e-09, 0.08368336795103419, 0.19981371332375772, 0.08708495848084548, 0.0011711748237898775, 6.792954520054704e-09, 3.686866170265613e-09, 3.850024730739617e-09, 1.774150136796265e-08, 1.2279399208621146e-08, 2.127968294875449e-09, 0.08708495453566033, 0.030616012962878414, 0.1998135615847072, 0.09594272076264095, 0.09453032203404742, 0.08807937228632941, 7.0376622587261555e-09, 5.317594635463957e-09, 8.60043726099197e-09, 0.0006675361411842823, 4.670632398754687e-09, 0.09594271985909132, 0.09453054547866405, 0.08625986293086613, 0.19981366007603707, 0.06193109436722905, 0.0959498592077743, 0.09400800477214567, 0.08723968529281366, 6.723685678043281e-09, 9.515179721142074e-09, 5.231182732000782e-08, 2.3370893326111993e-08, 0.06193090670035895, 0.09594962242844662, 0.0969776962959354, 0.08876257604652286, 0.19981389826150045, 0.009529159322197864, 0.06203573438690772, 0.09594892001125212, 0.09284590815101497, 6.791646101064488e-07, 6.759317885498587e-09, 6.078981040787756e-08, 0.006253434099038942, 0.009526987978989617, 0.06199790525617293, 0.09595268029093133, 0.0944678867655413, 0.09747338057432654, 0.19981421002274663]
,[0.04018438964706493, 0.05982237707138067, 0.0647169170928301, 0.09596998697412887, 0.0928600675077157, 6.99300362870683e-07, 7.171452663205156e-09, 0.044647564989214905, 0.04018950577457412, 0.0, 0.06287241393209966, 0.09597101503465302, 0.09957085674354547, 0.10337895142082522, 0.1998152473429711]
)


}



def lower_triangle_from_flat(flat, s):
    a = np.zeros((s, s))
    idx = 0
    for i in range(1, s):
        for j in range(i):
            a[i, j] = flat[idx]
            idx += 1
    return a

def check_order_conditions(a, b):
    s = len(b)
    c = a.sum(axis=1)
    v1 = np.sum(b)
    v2 = np.sum(b * c)
    v3a = np.sum(b * c ** 2)
    v3b = np.sum([b[i] * np.dot(a[i, :], c) for i in range(s)])
    r1 = abs(v1 - 1.0)
    r2 = abs(v2 - 0.5)
    r3a = abs(v3a - 1.0 / 3.0)
    r3b = abs(v3b - 1.0 / 6.0)
    return (v1, r1), (v2, r2), (v3a, r3a), (v3b, r3b)

tol = 1e-10

print("### Numerical checker of third order conditions of heuristics\n")

for key, (desc, a_list, b_list) in huestrics.items():
    print(f"--- Heuristic {key}: {desc} ---")
    s = 15
    a = lower_triangle_from_flat(a_list, s)
    b = np.array(b_list)
    (v1, r1), (v2, r2), (v3a, r3a), (v3b, r3b) = check_order_conditions(a, b)
    print(f"  Order 1: sum(b) = {v1:.14f} (residual={r1:.1e}) — {'PASS' if r1 < tol else 'FAIL'}")
    print(f"  Order 2: sum(b*c) = {v2:.14f} (residual={r2:.1e}) — {'PASS' if r2 < tol else 'FAIL'}")
    print(f"  Order 3a: sum(b*c^2) = {v3a:.14f} (residual={r3a:.1e}) — {'PASS' if r3a < tol else 'FAIL'}")
    print(f"  Order 3b: sum(b[i]*a[i,j]*c[j]) = {v3b:.14f} (residual={r3b:.1e}) — {'PASS' if r3b < tol else 'FAIL'}")
    if all([r1 < tol, r2 < tol, r3a < tol, r3b < tol]):
        print("  ✅ All 3rd order conditions satisfied!\n")
    else:
        print("  ❌ At least one condition not satisfied.\n")

print("=== Finished ===")
